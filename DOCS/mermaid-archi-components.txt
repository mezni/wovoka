flowchart TB
    %% === Public Zone ===
    subgraph Clients["üåê Public Zone"]
        Client["Mobile / Web Client"]
        OperatorUI["Operator UI"]
        AdminUI["Admin UI"]
    end

    %% === Gateway Zone ===
    subgraph Gateway["üß≠ API Gateway Zone"]
        APIGW["API Gateway<br/>(Tyk / Envoy)<br/><small>Routing ‚Ä¢ AuthN ‚Ä¢ Rate-limit</small>"]
    end

    %% === Security Zone ===
    subgraph Security["üîê Identity & Auth Zone"]
        Auth["Auth-Service<br/><small>(Integrates with Keycloak)</small>"]
        AuthCache["Auth-Cache<br/><small>(JWT/Introspection cache)</small>"]
        KC["Keycloak<br/><small>OIDC / OAuth2 Provider</small>"]
        KD["Keycloak DB"]
    end    

    %% === Internal Services Zone ===
    subgraph Internal["‚öôÔ∏è Internal Microservices Zone"]
        MS1["Locator-Service<br/><small>Find nearby stations</small>"]
        MS2["Configurator-Service<br/><small>Manage stations, operators, tariffs</small>"]
        SharedDB["PostgreSQL<br/><small>Shared Data Storage</small>"]
    end

    %% === Optional Infra Zone ===
    subgraph Infra["üì° Infra & Eventing Zone"]
        NATS["NATS / Message Bus<br/><small>station.created / updated events</small>"]
        Metrics["Prometheus / Grafana"]
    end

    %% === Client to Gateway Flows ===
    Client -->|"HTTPS (OIDC tokens)"| APIGW
    OperatorUI -->|"HTTPS (JWT)"| APIGW
    AdminUI -->|"HTTPS (JWT)"| APIGW

    %% === Gateway to Security Zone ===
    APIGW -->|Auth request / Login| Auth
    Auth -->|Request token| KC 
    Auth -->|Token check| AuthCache       
    KC -->|Read/Write user data| KD

    %% === Gateway to Internal Services ===
    APIGW -->|Validated JWT| MS1
    APIGW -->|Validated JWT| MS2

    %% === Internal Services to DB ===
    MS1 -->|Read / Query| SharedDB
    MS2 -->|CRUD / Config| SharedDB

    %% === Event Bus Integration ===
    MS2 -->|Publish station.created| NATS
    NATS -->|Notify cache refresh| MS1

    %% === Monitoring ===
    APIGW --> Metrics
    Auth --> Metrics
    MS1 --> Metrics
    MS2 --> Metrics

    %% === Class Styling ===
    classDef external fill:#f9f9f9,stroke:#666,stroke-width:1px;
    classDef gateway fill:#fff7e6,stroke:#ffb703,stroke-width:2px;
    classDef security fill:#e3f2fd,stroke:#2196f3,stroke-width:2px;
    classDef internal fill:#f1f8e9,stroke:#4caf50,stroke-width:2px;
    classDef data fill:#fff3e0,stroke:#fb8c00,stroke-width:2px;
    classDef infra fill:#ede7f6,stroke:#7e57c2,stroke-width:2px;

    class Clients external;
    class Gateway gateway;
    class Security security;
    class Internal internal;
    class SharedDB data;
    class Infra infra;
